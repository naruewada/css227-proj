<%- include('../partials/header.ejs') %>
  <link rel="stylesheet" href="../stylesheets/moviedetail.css">
  <div class="total-detail">
    <div class="sub-detail">
      <div class="messege-detail">
        <h1 class="head-messege"><%= movie.name %></h1>
        <p class="messege-dec"><i class=" far fa-clock"></i> <%= movie.time %></p>
        <p class="messege-dec"><i class="fa fa-tags" ></i> <%= movie.genre %></p>
        <p class="messege-dec"><i class="far fa-calendar"></i> <%= movie.date %></p>
        <p class="messege-dec"><i class="fa fa-user-friends" ></i> <%= movie.actor %></p>

        <% if(!currentUser) { %>
          <form action="/login" method="POST">
              <button type="submit" class="favorite">favorite <i class="far fa-heart" id="unlike"></i></button>
          </form>
      <% } else { %>
      <div class="container-fluid mt-3" >
          <!-- function for check that user like or not -->
          <% var match = 0; var like_id = ''; %>
          <% currentUser.likes.forEach(function(liked){ if ( liked.movies.id == movie.id ) { match = 1; like_id = liked._id; } }); %>
          <% if( match == 1 ) { %>
              <form action="/movie/<%= like_id %>/unlike" method="POST">
                  <button type="submit" class="favorite liked" >favorite <i class="fa fa-heart" id="like" ></i></button>
              </form>
          <% } else { %>
              <form action="/movie/<%= movie._id %>/like" method="POST">
                  <button type="submit" class="favorite">favorite <i class="far fa-heart" id="unlike" ></i></button>
              </form>
          <% } %>
      </div>
      <% } %>
      </div>
    </div>
    <div class="trailer-vdo" ><iframe  src="<%= movie.trailer %>" allowfullscreen ></iframe></div>
  </div>


<div class="poster-movie">
  <p><img src="<%= movie.image %>" style="width: 13rem;"></p>
  <div>
    <h3 class="h3-header-movie"><%= movie.name %></h3>
    <p class="movie-rating"><i class="fa fa-star"></i> <%= movie.rating %> / 10</p>

  </div>
</div>
  
  <hr>
  <p class="comments">Review! </p>
  <% var i = 0; %>
  <% movie.comments.forEach(function(comment){ %>
    <p class="dec-2">
      <i class="fa fa-user"></i>
      <strong>
        <%= comment.author.firstname %>
      </strong> 
      : <%= comment.text %>
      
      <% if(currentUser && comment.author.id.equals(currentUser._id)  || currentUser && currentUser.state === 'admin' || currentUser && currentUser.state === 'cheif'){ %>
        <div class="d-flex justify-content-between align-items-center">
            <a href="/movie/<%= movie._id %>/edit" class="btn btn-warning">EDIT</a>
            <form action="/movie/<%= movie._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
              <!-- Button trigger modal -->
              <button type="button" class="btn btn-delete" data-bs-toggle="modal" data-bs-target="#deleteModal<%= i %>">
                  DELETE &nbsp;<i class="fa fa-trash"></i>
              </button>

              <!-- Modal -->
              <div class="modal fade" id="deleteModal<%= i %>" data-bs-backdrop="static" tabindex="-1">
                  <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title">DELETE COMMENT</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                              Do you want to delete this movie ?
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              <button type="submit" class="btn btn-primary">Confirm</button>
                          </div>
                      </div>
                  </div>
              </div>
          </form>


          <!-- <a class="btn btn-warning" href="/movie/<%= movie._id %>/comments/<%= comment._id %>/edit">edit</a>
          <form action="/movie/<%= movie._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
            <button class="btn btn-danger">Delete</button>
          </form> -->
        </div>
      <% } %>
      <hr>
      
    </p>
  <% i++; }); %>

   

      <div class='container'>
        <form action='/movie/<%= movie._id %>/comments' method='POST'>
        <div class="mb-3">
          <input type="text" class="form-control" name='comment[text]' placeholder='Comment'>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
      <%- include('../partials/footer.ejs') %>