<%- include('../partials/header.ejs') %>

<% var weekday = new Array(7), month = new Array(12); %>
<% weekday[0] = "Sun", weekday[1] = "Mon", weekday[2] = "Tues", weekday[3] = "Wed", weekday[4] = "Thurs", weekday[5] = "Fri", weekday[6] = "Sat"; %>
<% month[0] = "Jan", month[1] = "Feb",month[2] = "Mar", month[3] = "Apr", month[4] = "May", month[5] = "June", month[6] = "July", month[7] = "Aug", month[8] = "Sept", month[9] = "Oct", month[10] = "Nov", month[11] = "Dec";  %>
<% var Time1 = new Date() %>

<% var Time2 = new Date(Time1) %>
<% Time2.setDate(Time2.getDate() + 1) %>

<% var Time3 = new Date(Time2) %>
<% Time3.setDate(Time3.getDate() + 1) %>

<% var Time4 = new Date(Time3) %>
<% Time4.setDate(Time4.getDate() + 1) %>

<% var Day1 = Time1.getDay(), Month1 = Time1.getMonth(), Date1 = Time1.getDate(); %>
<% var D1 = weekday[Day1] + ' ' + Date1 + ' ' + month[Month1]; %>

<% var Day2 = Time2.getDay(), Month2 = Time2.getMonth(), Date2 = Time2.getDate(); %>
<% var D2 = weekday[Day2] + ' ' + Date2 + ' ' + month[Month2]; %>

<% var Day3 = Time3.getDay(), Month3 = Time3.getMonth(), Date3 = Time3.getDate(); %>
<% var D3 = weekday[Day3] + ' ' + Date3 + ' ' + month[Month3]; %>

<% var Day4 = Time4.getDay(), Month4 = Time4.getMonth(), Date4 = Time4.getDate(); %>
<% var D4 = weekday[Day4] + ' ' + Date4 + ' ' + month[Month4]; %>


  <link rel="stylesheet" href="../stylesheets/moviedetail.css">
  <div class="total-detail">
    <div class="sub-detail">
      <div class="messege-detail">
        <h1 class="head-messege"><%= movie.name %></h1>
        <p class="messege-dec"><i class=" far fa-clock"></i> <%= movie.time %></p>
        <p class="messege-dec"><i class="fa fa-tags" ></i> <%= movie.genre %></p>
        <p class="messege-dec"><i class="far fa-calendar"></i> <%= movie.date %></p>
        <p class="messege-dec"><i class="fa fa-user-friends" ></i> <%= movie.actor %></p>

        <% if(!currentUser) { %>
          <form action="/login" method="POST">
              <button type="submit" class="favorite">favorite <i class="far fa-heart" id="unlike"></i></button>
          </form>
      <% } else { %>
      <div class="container-fluid mt-3" >
          <!-- function for check that user like or not -->
          <% var match = 0; var like_id = ''; %>
          <% currentUser.likes.forEach(function(liked){ if ( liked.movies.id == movie.id ) { match = 1; like_id = liked._id; } }); %>
          <% if( match == 1 ) { %>
              <form action="/movie/<%= like_id %>/unlike" method="POST">
                  <button type="submit" class="favorite liked" >favorite <i class="fa fa-heart" id="like" ></i></button>
              </form>
          <% } else { %>
              <form action="/movie/<%= movie._id %>/like" method="POST">
                  <button type="submit" class="favorite">favorite <i class="far fa-heart" id="unlike" ></i></button>
              </form>
          <% } %>
      </div>
      <% } %>
      </div>
    </div>
    <div class="trailer-vdo" ><iframe  src="<%= movie.trailer %>" allowfullscreen ></iframe></div>
  </div>


<div class="poster-movie">
  <p><img src="<%= movie.image %>" style="width: 13rem;"></p>
  <div>
    <h3 class="h3-header-movie"><%= movie.name %></h3>
    <p class="movie-rating"><i class="fa fa-star"></i> <%= movie.rating %> / 10</p>

    <button><a href="/movie/<%= movie.id %>/showtime">Get ticket</a></button>

  </div>
</div>
  
  <hr>
  <p class="comments">Review! </p>
  <% var i = 0; %>
  <% movie.comments.forEach(function(comment){ %>
    <p class="dec-2">
      <i class="fa fa-user"></i>
      <strong>
        <%= comment.author.firstname %>
      </strong> 
      : <%= comment.text %>
      
      <% if(currentUser && comment.author.id.equals(currentUser._id)  || currentUser && currentUser.state === 'admin' || currentUser && currentUser.state === 'cheif'){ %>
        <div class="d-flex justify-content-between align-items-center">
            <a href="/movie/<%= movie._id %>/edit" class="btn btn-warning">EDIT</a>
            <form action="/movie/<%= movie._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
              <!-- Button trigger modal -->
              <button type="button" class="btn btn-delete" data-bs-toggle="modal" data-bs-target="#deleteModal<%= i %>">
                  DELETE &nbsp;<i class="fa fa-trash"></i>
              </button>

              <!-- Modal -->
              <div class="modal fade" id="deleteModal<%= i %>" data-bs-backdrop="static" tabindex="-1">
                  <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title">DELETE COMMENT</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                              Do you want to delete this movie ?
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                              <button type="submit" class="btn btn-primary">Confirm</button>
                          </div>
                      </div>
                  </div>
              </div>
          </form>


          <!-- <a class="btn btn-warning" href="/movie/<%= movie._id %>/comments/<%= comment._id %>/edit">edit</a>
          <form action="/movie/<%= movie._id %>/comments/<%= comment._id %>?_method=DELETE" method="POST">
            <button class="btn btn-danger">Delete</button>
          </form> -->
        </div>
      <% } %>
      <hr>
      
    </p>
  <% i++; }); %>

   

      <div class='container'>
        <form action='/movie/<%= movie._id %>/comments' method='POST'>
        <div class="mb-3">
          <input type="text" class="form-control" name='comment[text]' placeholder='Comment'>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>


      <script>
        var weekday = new Array(7), month = new Array(12);
        weekday[0] = "Sun", weekday[1] = "Mon", weekday[2] = "Tues", weekday[3] = "Wed", weekday[4] = "Thurs", weekday[5] = "Fri", weekday[6] = "Sat";
        month[0] = "Jan", month[1] = "Feb",month[2] = "Mar", month[3] = "Apr", month[4] = "May", month[5] = "June", month[6] = "July", month[7] = "Aug", month[8] = "Sept", month[9] = "Oct", month[10] = "Nov", month[11] = "Dec";
    
        var currentTime = new Date();
        var hours = currentTime.getHours(), minutes = currentTime.getMinutes();
        var todayDay = currentTime.getDay(), todayMonth = currentTime.getMonth(), todayDate = currentTime.getDate();
        var today = weekday[todayDay] + ' ' + todayDate + ' ' + month[todayMonth];
        var selectDay = document.getElementById("selectDay").value;
    
        if ( today == selectDay ) {
            if ( hours == 11 && minutes > 15 || hours > 11 ){
                document.getElementById("11").disabled = true;
            }
            if ( hours >= 13 && minutes > 15 || hours > 13 ){
                document.getElementById("13").disabled = true;
            }
            if ( hours >= 15 && minutes > 15 || hours > 15 ){
                document.getElementById("15").disabled = true;
            }
            if ( hours >= 16 && minutes > 15 || hours > 16 ){
                document.getElementById("16").disabled = true;
            }
            if ( hours >= 18 && minutes > 15 || hours > 18 ){
                document.getElementById("18").disabled = true;
            }
            if ( hours >= 21 && minutes > 15 || hours > 21 ){
                document.getElementById("21").disabled = true;
            }
        }
    
        function check(checkSelectDay) {
            if ( today == checkSelectDay ) {
                if ( hours >= 11 && minutes > 15 || hours > 11 ){
                    document.getElementById("11").disabled = true;
                }
                if ( hours >= 13 && minutes > 15 || hours > 13 ){
                    document.getElementById("13").disabled = true;
                }
                if ( hours >= 15 && minutes > 15 || hours > 15 ){
                    document.getElementById("15").disabled = true;
                }
                if ( hours >= 16 && minutes > 15 || hours > 16 ){
                    document.getElementById("16").disabled = true;
                }
                if ( hours >= 18 && minutes > 15 || hours > 18 ){
                    document.getElementById("18").disabled = true;
                }
                if ( hours >= 21 && minutes > 15 || hours > 21 ){
                    document.getElementById("21").disabled = true;
                }
            } else if ( today != checkSelectDay ) {
                document.getElementById("11").disabled = false;
                document.getElementById("13").disabled = false;
                document.getElementById("15").disabled = false;
                document.getElementById("16").disabled = false;
                document.getElementById("18").disabled = false;
                document.getElementById("21").disabled = false;
            }
        }
    </script>


      <%- include('../partials/footer.ejs') %>